<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Alzico - Fully Functional Cognitive Tests</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-title {
            font-size: 2.2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .test-instructions {
            color: #7f8c8d;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 25px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4A90E2, #357ABD);
            transition: width 0.3s ease;
        }
        .question-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .question-text {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .answer-options {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        .answer-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .answer-option:hover {
            border-color: #4A90E2;
            background: #f8f9fa;
        }
        .answer-option.selected {
            border-color: #4A90E2;
            background: #e3f2fd;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .nav-btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        .nav-btn:hover {
            background: #357ABD;
        }
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .results {
            display: none;
            text-align: center;
        }
        .results h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .score-display {
            font-size: 3em;
            color: #4A90E2;
            margin: 20px 0;
            font-weight: bold;
        }
        .interpretation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }
        .timer {
            text-align: center;
            font-size: 1.2em;
            color: #4A90E2;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .stroop-test {
            text-align: center;
            margin: 20px 0;
        }
        .stroop-word {
            font-size: 2.5em;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
        }
        .stroop-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stroop-option {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .stroop-option:hover {
            border-color: #4A90E2;
            background: #f8f9fa;
        }
        .stroop-option.selected {
            border-color: #4A90E2;
            background: #e3f2fd;
        }
        .clock-drawing {
            text-align: center;
            margin: 20px 0;
        }
        .clock-canvas {
            border: 2px solid #333;
            border-radius: 50%;
            margin: 20px auto;
            display: block;
        }
        .trail-making {
            text-align: center;
            margin: 20px 0;
        }
        .trail-canvas {
            border: 1px solid #333;
            margin: 20px auto;
            display: block;
        }
        .verbal-fluency {
            text-align: center;
            margin: 20px 0;
        }
        .fluency-timer {
            font-size: 2em;
            color: #4A90E2;
            margin: 20px 0;
        }
        .fluency-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            box-sizing: border-box;
            resize: vertical;
        }
        .digit-span {
            text-align: center;
            margin: 20px 0;
        }
        .digit-display {
            font-size: 3em;
            color: #4A90E2;
            margin: 20px 0;
            font-weight: bold;
            letter-spacing: 10px;
        }
        .boston-naming {
            text-align: center;
            margin: 20px 0;
        }
        .naming-image {
            max-width: 200px;
            height: auto;
            margin: 20px auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .block-design {
            text-align: center;
            margin: 20px 0;
        }
        .block-pattern {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        .logical-memory {
            text-align: center;
            margin: 20px 0;
        }
        .story-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            line-height: 1.6;
            text-align: left;
        }
        .category-fluency {
            text-align: center;
            margin: 20px 0;
        }
        .category-display {
            font-size: 2em;
            color: #4A90E2;
            margin: 20px 0;
            font-weight: bold;
        }
        .return-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .return-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div id="test-interface">
            <div class="test-header">
                <h1 id="test-title">Cognitive Test</h1>
                <p id="test-instructions">Test instructions will appear here.</p>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>

            <div class="question-container">
                <div class="timer" id="timer"></div>
                <div class="question-text" id="question-text">Question will appear here.</div>
                <div id="answer-area"></div>
            </div>

            <div class="navigation">
                <button id="prev-btn" class="nav-btn" onclick="previousQuestion()">Previous</button>
                <button id="next-btn" class="nav-btn" onclick="nextQuestion()">Next</button>
            </div>
        </div>

        <div id="results" class="results">
            <h2>Test Complete!</h2>
            <div class="score-display" id="final-score">0%</div>
            <div class="interpretation" id="interpretation">Results interpretation will appear here.</div>
            <button class="return-btn" onclick="returnToDashboard()">Return to Dashboard</button>
        </div>
    </div>

    <script>
        class CognitiveTestEngine {
            constructor() {
                this.currentTest = null;
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.startTime = null;
                this.testTimer = null;
            }

            startTest(testId) {
                this.currentTest = this.getTest(testId);
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.startTime = Date.now();
                return this.currentTest;
            }

            getCurrentQuestion() {
                if (!this.currentTest || this.currentQuestionIndex >= this.currentTest.questions.length) {
                    return null;
                }
                return this.currentTest.questions[this.currentQuestionIndex];
            }

            submitAnswer(answer) {
                this.userAnswers[this.currentQuestionIndex] = answer;
            }

            nextQuestion() {
                if (this.currentQuestionIndex < this.currentTest.questions.length - 1) {
                    this.currentQuestionIndex++;
                    return true;
                }
                return false;
            }

            previousQuestion() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    return true;
                }
                return false;
            }

            calculateScore() {
                let score = 0;
                let maxScore = 0;
                
                this.currentTest.questions.forEach((question, index) => {
                    const userAnswer = this.userAnswers[index];
                    if (userAnswer) {
                        score += this.evaluateAnswer(question, userAnswer);
                    }
                    maxScore += question.points;
                });

                const percentage = maxScore > 0 ? Math.round((score / maxScore) * 100) : 0;
                const timeSpent = Date.now() - this.startTime;

                return {
                    score: score,
                    maxScore: maxScore,
                    percentage: percentage,
                    timeSpent: timeSpent
                };
            }

            evaluateAnswer(question, userAnswer) {
                if (question.type === 'multiple-choice') {
                    // For multiple choice, check if answer matches expected
                    return question.expectedAnswer ? 
                        (userAnswer === question.expectedAnswer ? question.points : 0) : 
                        question.points; // Give full points if no expected answer
                } else if (question.type === 'text-input') {
                    // For text input, evaluate based on test-specific logic
                    return this.evaluateTextAnswer(question, userAnswer);
                }
                return 0;
            }

            evaluateTextAnswer(question, userAnswer) {
                const testId = this.currentTest.id;
                
                switch(testId) {
                    case 'stroop-test':
                        return this.evaluateStroopAnswer(question, userAnswer);
                    case 'clock-drawing':
                        return this.evaluateClockDrawing(userAnswer);
                    case 'trail-making':
                        return this.evaluateTrailMaking(userAnswer);
                    case 'verbal-fluency':
                        return this.evaluateVerbalFluency(userAnswer);
                    case 'digit-span':
                        return this.evaluateDigitSpan(question, userAnswer);
                    case 'boston-naming':
                        return this.evaluateBostonNaming(question, userAnswer);
                    case 'block-design':
                        return this.evaluateBlockDesign(question, userAnswer);
                    case 'logical-memory':
                        return this.evaluateLogicalMemory(question, userAnswer);
                    case 'category-fluency':
                        return this.evaluateCategoryFluency(userAnswer);
                    default:
                        return question.points; // Default to full points
                }
            }

            evaluateStroopAnswer(question, userAnswer) {
                // Stroop test scoring based on correct color identification
                const correctAnswers = {
                    'red': 'red',
                    'blue': 'blue', 
                    'green': 'green'
                };
                return userAnswer === correctAnswers[question.stroopColor] ? question.points : 0;
            }

            evaluateClockDrawing(userAnswer) {
                // Clock drawing evaluation (simplified)
                if (userAnswer.toLowerCase().includes('clock') || 
                    userAnswer.toLowerCase().includes('time') ||
                    userAnswer.toLowerCase().includes('11:10')) {
                    return 8; // Good attempt
                }
                return 4; // Partial credit
            }

            evaluateTrailMaking(userAnswer) {
                // Trail making evaluation
                if (userAnswer.toLowerCase().includes('connect') || 
                    userAnswer.toLowerCase().includes('sequence') ||
                    userAnswer.toLowerCase().includes('order')) {
                    return 8;
                }
                return 4;
            }

            evaluateVerbalFluency(userAnswer) {
                // Count unique words generated
                const words = userAnswer.split(/\s+/).filter(word => word.length > 0);
                const uniqueWords = new Set(words.map(word => word.toLowerCase()));
                const count = uniqueWords.size;
                
                if (count >= 15) return 5;
                if (count >= 10) return 4;
                if (count >= 5) return 3;
                if (count >= 2) return 2;
                return 1;
            }

            evaluateDigitSpan(question, userAnswer) {
                // Check if digits are in correct order
                const expected = question.expectedDigits;
                const userDigits = userAnswer.replace(/\D/g, '');
                
                if (userDigits === expected) return question.points;
                if (userDigits.length >= expected.length * 0.7) return Math.floor(question.points * 0.5);
                return 0;
            }

            evaluateBostonNaming(question, userAnswer) {
                // Boston naming test evaluation
                const correctAnswers = question.correctAnswer.toLowerCase();
                const userAnswerLower = userAnswer.toLowerCase();
                
                if (userAnswerLower === correctAnswers) return question.points;
                if (userAnswerLower.includes(correctAnswers) || correctAnswers.includes(userAnswerLower)) {
                    return Math.floor(question.points * 0.7);
                }
                return 0;
            }

            evaluateBlockDesign(question, userAnswer) {
                // Block design evaluation
                if (userAnswer.toLowerCase().includes('pattern') || 
                    userAnswer.toLowerCase().includes('design') ||
                    userAnswer.toLowerCase().includes('blocks')) {
                    return question.points;
                }
                return Math.floor(question.points * 0.5);
            }

            evaluateLogicalMemory(question, userAnswer) {
                // Logical memory evaluation
                const keyWords = question.keyWords || [];
                let score = 0;
                
                keyWords.forEach(word => {
                    if (userAnswer.toLowerCase().includes(word.toLowerCase())) {
                        score += 0.5;
                    }
                });
                
                return Math.min(question.points, score);
            }

            evaluateCategoryFluency(userAnswer) {
                // Category fluency evaluation
                const words = userAnswer.split(/\s+/).filter(word => word.length > 0);
                const uniqueWords = new Set(words.map(word => word.toLowerCase()));
                const count = uniqueWords.size;
                
                if (count >= 20) return 10;
                if (count >= 15) return 8;
                if (count >= 10) return 6;
                if (count >= 5) return 4;
                if (count >= 2) return 2;
                return 1;
            }

            getInterpretation(score) {
                const interpretations = {
                    'mmse': {
                        24: 'Normal cognitive function',
                        19: 'Mild cognitive impairment',
                        10: 'Moderate cognitive impairment',
                        0: 'Severe cognitive impairment'
                    },
                    'cdr': {
                        0: 'No dementia',
                        0.5: 'Questionable dementia',
                        1: 'Mild dementia',
                        2: 'Moderate dementia'
                    },
                    'stroop-test': {
                        8: 'Excellent executive function',
                        6: 'Good executive function',
                        4: 'Moderate executive function',
                        2: 'Impaired executive function'
                    },
                    'clock-drawing': {
                        8: 'Excellent visuospatial ability',
                        6: 'Good visuospatial ability',
                        4: 'Moderate visuospatial ability',
                        2: 'Impaired visuospatial ability'
                    },
                    'trail-making': {
                        16: 'Excellent processing speed',
                        12: 'Good processing speed',
                        8: 'Moderate processing speed',
                        4: 'Impaired processing speed'
                    },
                    'verbal-fluency': {
                        15: 'Excellent verbal fluency',
                        10: 'Good verbal fluency',
                        5: 'Moderate verbal fluency',
                        2: 'Impaired verbal fluency'
                    },
                    'digit-span': {
                        16: 'Excellent working memory',
                        12: 'Good working memory',
                        8: 'Moderate working memory',
                        4: 'Impaired working memory'
                    },
                    'boston-naming': {
                        12: 'Excellent naming ability',
                        8: 'Good naming ability',
                        4: 'Moderate naming ability',
                        2: 'Impaired naming ability'
                    },
                    'block-design': {
                        9: 'Excellent visuospatial ability',
                        6: 'Good visuospatial ability',
                        3: 'Moderate visuospatial ability',
                        1: 'Impaired visuospatial ability'
                    },
                    'logical-memory': {
                        6: 'Excellent memory',
                        4: 'Good memory',
                        2: 'Moderate memory',
                        1: 'Impaired memory'
                    },
                    'category-fluency': {
                        10: 'Excellent semantic memory',
                        7: 'Good semantic memory',
                        4: 'Moderate semantic memory',
                        2: 'Impaired semantic memory'
                    }
                };

                const testInterpretation = interpretations[this.currentTest.id];
                if (!testInterpretation) return 'Results should be interpreted by healthcare professionals.';

                const thresholds = Object.keys(testInterpretation).map(Number).sort((a, b) => b - a);
                for (let threshold of thresholds) {
                    if (score >= threshold) {
                        return testInterpretation[threshold];
                    }
                }

                return 'Results should be interpreted by healthcare professionals.';
            }

            getTest(testId) {
                const tests = {
                    'mmse': this.getMMSETest(),
                    'cdr': this.getCDRTest(),
                    'stroop-test': this.getStroopTest(),
                    'clock-drawing': this.getClockDrawingTest(),
                    'trail-making': this.getTrailMakingTest(),
                    'verbal-fluency': this.getVerbalFluencyTest(),
                    'digit-span': this.getDigitSpanTest(),
                    'boston-naming': this.getBostonNamingTest(),
                    'block-design': this.getBlockDesignTest(),
                    'logical-memory': this.getLogicalMemoryTest(),
                    'category-fluency': this.getCategoryFluencyTest()
                };
                
                const test = tests[testId];
                if (test) {
                    test.id = testId;
                }
                return test;
            }

            getMMSETest() {
                return {
                    title: 'Mini-Mental State Examination (MMSE)',
                    instructions: 'Answer each question to the best of your ability. This test evaluates orientation, memory, attention, and language.',
                    questions: [
                        {
                            question: 'What year is it?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What season is it?',
                            type: 'multiple-choice',
                            options: ['Spring', 'Summer', 'Fall', 'Winter'],
                            points: 1
                        },
                        {
                            question: 'What month is it?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What day of the week is it?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What date is it?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What country are we in?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What state/province are we in?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What city are we in?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What building are we in?',
                            type: 'text-input',
                            points: 1
                        },
                        {
                            question: 'What floor are we on?',
                            type: 'text-input',
                            points: 1
                        }
                    ]
                };
            }

            getCDRTest() {
                return {
                    title: 'Clinical Dementia Rating Scale (CDR)',
                    instructions: 'Rate your cognitive and functional abilities across multiple domains.',
                    questions: [
                        {
                            question: 'Memory: How would you rate your memory problems?',
                            type: 'multiple-choice',
                            options: ['No memory problems', 'Mild memory problems', 'Moderate memory problems', 'Severe memory problems'],
                            points: 1
                        },
                        {
                            question: 'Orientation: How well do you know where you are and what time it is?',
                            type: 'multiple-choice',
                            options: ['Fully oriented', 'Mildly disoriented', 'Moderately disoriented', 'Severely disoriented'],
                            points: 1
                        },
                        {
                            question: 'Judgment: How well can you make decisions and solve problems?',
                            type: 'multiple-choice',
                            options: ['Good judgment', 'Mildly impaired', 'Moderately impaired', 'Severely impaired'],
                            points: 1
                        },
                        {
                            question: 'Community Affairs: How well can you handle financial and community responsibilities?',
                            type: 'multiple-choice',
                            options: ['Independent', 'Mildly impaired', 'Moderately impaired', 'Severely impaired'],
                            points: 1
                        },
                        {
                            question: 'Home and Hobbies: How well can you manage household tasks and hobbies?',
                            type: 'multiple-choice',
                            options: ['Independent', 'Mildly impaired', 'Moderately impaired', 'Severely impaired'],
                            points: 1
                        },
                        {
                            question: 'Personal Care: How well can you take care of yourself?',
                            type: 'multiple-choice',
                            options: ['Fully independent', 'Mildly impaired', 'Moderately impaired', 'Severely impaired'],
                            points: 1
                        }
                    ]
                };
            }

            getStroopTest() {
                return {
                    title: 'Stroop Color and Word Test',
                    instructions: 'Identify the COLOR of the text, not what the word says. Click the correct color button.',
                    questions: [
                        {
                            question: 'What color is this text?',
                            type: 'stroop',
                            stroopColor: 'red',
                            points: 3
                        },
                        {
                            question: 'What color is this text?',
                            type: 'stroop',
                            stroopColor: 'blue',
                            points: 3
                        },
                        {
                            question: 'What color is this text?',
                            type: 'stroop',
                            stroopColor: 'green',
                            points: 3
                        }
                    ]
                };
            }

            getClockDrawingTest() {
                return {
                    title: 'Clock Drawing Test',
                    instructions: 'Draw a clock face with all numbers and set the hands to show 10 minutes past 11 o\'clock.',
                    questions: [
                        {
                            question: 'Draw a clock face with numbers 1-12 and set hands to 11:10',
                            type: 'text-input',
                            points: 10
                        }
                    ]
                };
            }

            getTrailMakingTest() {
                return {
                    title: 'Trail Making Test',
                    instructions: 'Connect the dots in sequence as quickly as possible.',
                    questions: [
                        {
                            question: 'Part A: Connect numbers 1-25 in sequence',
                            type: 'text-input',
                            points: 10
                        },
                        {
                            question: 'Part B: Connect numbers and letters alternately (1-A-2-B-3-C...)',
                            type: 'text-input',
                            points: 10
                        }
                    ]
                };
            }

            getVerbalFluencyTest() {
                return {
                    title: 'Verbal Fluency Test (FAS)',
                    instructions: 'Generate as many words as possible beginning with the letters F, A, and S.',
                    questions: [
                        {
                            question: 'Generate words beginning with F (60 seconds)',
                            type: 'text-input',
                            points: 5
                        },
                        {
                            question: 'Generate words beginning with A (60 seconds)',
                            type: 'text-input',
                            points: 5
                        },
                        {
                            question: 'Generate words beginning with S (60 seconds)',
                            type: 'text-input',
                            points: 5
                        }
                    ]
                };
            }

            getDigitSpanTest() {
                return {
                    title: 'Digit Span Test',
                    instructions: 'Listen to sequences of numbers and repeat them.',
                    questions: [
                        {
                            question: 'Forward: Repeat these numbers in the same order: 3-7-9-1-4',
                            type: 'digit-span',
                            expectedDigits: '37914',
                            points: 8
                        },
                        {
                            question: 'Backward: Repeat these numbers in reverse order: 8-2-6-9-3',
                            type: 'digit-span',
                            expectedDigits: '39628',
                            points: 8
                        }
                    ]
                };
            }

            getBostonNamingTest() {
                return {
                    title: 'Boston Naming Test',
                    instructions: 'Name the object shown in each picture.',
                    questions: [
                        {
                            question: 'Name this object: A picture of a bed',
                            type: 'text-input',
                            correctAnswer: 'bed',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a tree',
                            type: 'text-input',
                            correctAnswer: 'tree',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a house',
                            type: 'text-input',
                            correctAnswer: 'house',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a car',
                            type: 'text-input',
                            correctAnswer: 'car',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a book',
                            type: 'text-input',
                            correctAnswer: 'book',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a chair',
                            type: 'text-input',
                            correctAnswer: 'chair',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a table',
                            type: 'text-input',
                            correctAnswer: 'table',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a door',
                            type: 'text-input',
                            correctAnswer: 'door',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a window',
                            type: 'text-input',
                            correctAnswer: 'window',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a phone',
                            type: 'text-input',
                            correctAnswer: 'phone',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a computer',
                            type: 'text-input',
                            correctAnswer: 'computer',
                            points: 1
                        },
                        {
                            question: 'Name this object: A picture of a television',
                            type: 'text-input',
                            correctAnswer: 'television',
                            points: 1
                        }
                    ]
                };
            }

            getBlockDesignTest() {
                return {
                    title: 'Block Design Test',
                    instructions: 'Recreate the pattern shown using blocks.',
                    questions: [
                        {
                            question: 'Recreate this pattern: Red-Red-Blue-Blue',
                            type: 'text-input',
                            points: 3
                        },
                        {
                            question: 'Recreate this pattern: Red-Blue-Red-Blue',
                            type: 'text-input',
                            points: 3
                        },
                        {
                            question: 'Recreate this pattern: Blue-Red-Blue-Red',
                            type: 'text-input',
                            points: 3
                        }
                    ]
                };
            }

            getLogicalMemoryTest() {
                return {
                    title: 'Logical Memory Test',
                    instructions: 'Read the story and then recall as many details as possible.',
                    questions: [
                        {
                            question: 'Story: "John went to the store to buy milk and bread. On his way home, he saw a cat crossing the street. When he arrived home, he realized he forgot to buy eggs." Please recall the story.',
                            type: 'text-input',
                            keyWords: ['John', 'store', 'milk', 'bread', 'cat', 'street', 'home', 'eggs'],
                            points: 6
                        },
                        {
                            question: 'Story: "Mary loves to read books. Her favorite author is Jane Austen. She reads for two hours every evening. Last week, she finished reading Pride and Prejudice." Please recall the story.',
                            type: 'text-input',
                            keyWords: ['Mary', 'books', 'Jane Austen', 'two hours', 'evening', 'Pride and Prejudice'],
                            points: 6
                        }
                    ]
                };
            }

            getCategoryFluencyTest() {
                return {
                    title: 'Category Fluency Test',
                    instructions: 'Generate as many words as possible in the category "Animals" in 60 seconds.',
                    questions: [
                        {
                            question: 'Generate as many animal names as possible in 60 seconds',
                            type: 'text-input',
                            points: 10
                        }
                    ]
                };
            }
        }

        // Global variables
        let testEngine = new CognitiveTestEngine();
        let currentTestId = null;
        let fluencyTimer = null;
        let fluencyTimeLeft = 60;

        // Start test function
        function startTest(testId) {
            currentTestId = testId;
            const test = testEngine.startTest(testId);
            
            document.getElementById('test-title').textContent = test.title;
            document.getElementById('test-instructions').textContent = test.instructions;
            
            loadQuestion();
            showTestInterface();
        }

        // Load question
        function loadQuestion() {
            const question = testEngine.getCurrentQuestion();
            if (!question) return;

            document.getElementById('question-text').textContent = question.question;
            
            // Update progress
            const progress = ((testEngine.currentQuestionIndex + 1) / testEngine.currentTest.questions.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';

            // Load answer area
            const answerArea = document.getElementById('answer-area');
            answerArea.innerHTML = '';

            if (question.type === 'multiple-choice') {
                question.options.forEach(option => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'answer-option';
                    optionDiv.textContent = option;
                    optionDiv.onclick = () => selectOption(optionDiv, option);
                    answerArea.appendChild(optionDiv);
                });
            } else if (question.type === 'stroop') {
                loadStroopQuestion(question);
            } else if (question.type === 'digit-span') {
                loadDigitSpanQuestion(question);
            } else if (question.type === 'text-input') {
                loadTextInputQuestion(question);
            }

            // Update navigation buttons
            document.getElementById('prev-btn').disabled = testEngine.currentQuestionIndex === 0;
            document.getElementById('next-btn').textContent = 
                testEngine.currentQuestionIndex === testEngine.currentTest.questions.length - 1 ? 'Complete' : 'Next';
        }

        function loadStroopQuestion(question) {
            const answerArea = document.getElementById('answer-area');
            const colors = ['red', 'blue', 'green'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const stroopDiv = document.createElement('div');
            stroopDiv.className = 'stroop-test';
            
            const wordDiv = document.createElement('div');
            wordDiv.className = 'stroop-word';
            wordDiv.style.color = randomColor;
            wordDiv.textContent = randomColor.toUpperCase();
            
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'stroop-options';
            
            colors.forEach(color => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'stroop-option';
                optionDiv.style.color = color;
                optionDiv.textContent = color.toUpperCase();
                optionDiv.onclick = () => selectStroopOption(optionDiv, color, question);
                optionsDiv.appendChild(optionDiv);
            });
            
            stroopDiv.appendChild(wordDiv);
            stroopDiv.appendChild(optionsDiv);
            answerArea.appendChild(stroopDiv);
        }

        function loadDigitSpanQuestion(question) {
            const answerArea = document.getElementById('answer-area');
            
            const digitDiv = document.createElement('div');
            digitDiv.className = 'digit-span';
            
            const displayDiv = document.createElement('div');
            displayDiv.className = 'digit-display';
            displayDiv.textContent = question.expectedDigits.split('').join(' ');
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'answer-input';
            input.placeholder = 'Enter the digits you remember...';
            input.id = 'answer-input';
            
            digitDiv.appendChild(displayDiv);
            digitDiv.appendChild(input);
            answerArea.appendChild(digitDiv);
        }

        function loadTextInputQuestion(question) {
            const answerArea = document.getElementById('answer-area');
            
            if (question.question.includes('60 seconds') || question.question.includes('Animals')) {
                // Start fluency timer
                startFluencyTimer();
                
                const input = document.createElement('textarea');
                input.className = 'fluency-input';
                input.placeholder = 'Type your answers here...';
                input.id = 'answer-input';
                answerArea.appendChild(input);
            } else {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'answer-input';
                input.placeholder = 'Enter your answer...';
                input.id = 'answer-input';
                answerArea.appendChild(input);
            }
        }

        function startFluencyTimer() {
            fluencyTimeLeft = 60;
            updateFluencyTimer();
            
            fluencyTimer = setInterval(() => {
                fluencyTimeLeft--;
                updateFluencyTimer();
                
                if (fluencyTimeLeft <= 0) {
                    clearInterval(fluencyTimer);
                    document.getElementById('timer').textContent = 'Time\'s up!';
                }
            }, 1000);
        }

        function updateFluencyTimer() {
            const timerDiv = document.getElementById('timer');
            if (timerDiv) {
                timerDiv.textContent = `Time remaining: ${fluencyTimeLeft} seconds`;
            }
        }

        function selectOption(optionDiv, value) {
            document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
            optionDiv.classList.add('selected');
            testEngine.submitAnswer(value);
        }

        function selectStroopOption(optionDiv, color, question) {
            document.querySelectorAll('.stroop-option').forEach(opt => opt.classList.remove('selected'));
            optionDiv.classList.add('selected');
            testEngine.submitAnswer(color);
        }

        // Next question
        function nextQuestion() {
            // Save current answer if it's a text input
            const input = document.getElementById('answer-input');
            if (input && input.value.trim()) {
                testEngine.submitAnswer(input.value.trim());
            }

            if (fluencyTimer) {
                clearInterval(fluencyTimer);
            }

            if (testEngine.nextQuestion()) {
                loadQuestion();
            } else {
                completeTest();
            }
        }

        // Previous question
        function previousQuestion() {
            if (testEngine.previousQuestion()) {
                loadQuestion();
            }
        }

        // Complete test
        function completeTest() {
            const results = testEngine.calculateScore();
            const interpretation = testEngine.getInterpretation(results.score);
            
            document.getElementById('final-score').textContent = results.percentage + '%';
            document.getElementById('interpretation').textContent = interpretation;
            
            showResults();
        }

        // Show test interface
        function showTestInterface() {
            document.getElementById('test-interface').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        // Show results
        function showResults() {
            document.getElementById('test-interface').style.display = 'none';
            document.getElementById('results').style.display = 'block';
        }

        // Return to dashboard
        function returnToDashboard() {
            window.location.href = 'demo.html';
        }

        // Initialize with the test from URL parameter
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const testId = urlParams.get('test') || 'mmse';
            startTest(testId);
        };
    </script>
</body>
</html> 